<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="report_payslips_twice" inherit_id="hr_payroll.report_payslip_lang">
            <xpath expr="//t[@t-foreach='docs']" position="replace">
                <t t-foreach="range(2)" t-as="i">
                    <t t-foreach="docs" t-as="o">
                        <t t-set="inside_foreach_docs" t-value="o"/>
                        <t t-call="hr_payroll.report_payslip" t-lang="o.employee_id.address_home_id.lang"/>
                    </t>
                </t>
            </xpath>
        </template>

        <!--Agregando el Logo-->
        <template id="custom_inherit_layout_internal_report_payslip" inherit_id="web.internal_layout">
            <xpath expr="//div[1]/div[1]/div[1]/span[1]" position="after">
                <img class="img" src="custom_payslip_report/static/img/logo_industry.png" style="height:110px;" />
            </xpath>
        </template>

        <template id="custom_inherit_report_payslip" inherit_id="hr_payroll.report_payslip">
            <!--Ocultando la informacion de la empresa-->
            <xpath expr="//div[@class='page']/table[1]/tr[1]" position="replace">
            </xpath>

            <!--Ocultando la fecha del dia que se cancelo la nomina-->
            <xpath expr="//div[@class='page']/table[2]/tr[6]" position="replace">
            </xpath>

            <!-- <xpath expr="//div[@class='page']/table[2]/tr[6]/td[1]" position="replace">
            </xpath> -->

            <!--Ocultando la referencia y cuenta bancaria de la nomina a pagar-->
            <xpath expr="//div[@class='page']/table[2]/tr[4]" position="replace">
            </xpath>

            <!--Ocultando el email del empleado-->
            <xpath expr="//div[@class='page']/table[2]/tr[3]/td[2]" position="replace">
                <td><span t-field="o.employee_id.rif"/></td>
            </xpath>
            
            <xpath expr="//div[@class='page']/table[2]/tr[3]/td[1]" position="replace">
                <td><strong>RIF</strong></td>
            </xpath>

            <!--Oculatando la direccion de la empresa del empleado-->
            <xpath expr="//div[@class='page']/table[2]/tr[2]" position="replace">
            </xpath>

            <!--Cambiando el nombre designacion por cargo-->
            <xpath expr="//div[@class='page']/table[2]/tr[1]/td[3]" position="replace">
                <td><strong>Cargo</strong></td>
            </xpath>

            <!--Oculatando la columna codigo-->
            <xpath expr="//div[@class='page']/table[4]/thead/tr/th[1]" position="replace">
            </xpath>

            <xpath expr="//div[@class='page']/table[4]/tbody/tr[1]/td[1]" position="replace">
            </xpath>

            <xpath expr="//div[@class='page']/table[4]/tbody/tr[2]/td[1]" position="replace">
            </xpath>

            <!--Renombrando las columna Quantity/rate y Amount-->
            <xpath expr="//div[@class='page']/table[4]/thead/tr/th[4]" position="replace">
                <th>Asignaciones</th>
            </xpath>

            <xpath expr="//div[@class='page']/table[4]/thead/tr/th[5]" position="replace">
                <th>Deducciones</th>
            </xpath>

            <!--Salario del contrato-->
            <xpath expr="//div[@class='page']/table[3]/tr[1]/td[2]" position="replace">
                <td>
                    <t t-if="o.contract_id.name in ['Vigilante','Supervisor de Vigilancia','Director Seguridad y Prevención de Pérdida']">
                        <t t-if="o.struct_id.type_id.default_schedule_pay == 'weekly'">
                            <!-- Salario por 12 horas -->
                            <t t-set="days_salary" t-value="o.contract_id.hourly_wage * 12" />
                        </t>
                        <t t-else="">
                        </t>
                    </t>
                    <t t-if="o.struct_id.type_id.wage_type == 'monthly'">
                        <t t-if="o.payslip_run_id">
                            <t t-set="rate" t-value="o.payslip_run_id.custom_currency_id.name" />
                        </t>
                        <t t-else="">
                            <t t-set="rate" t-value="o.custom_currency_id.name" />
                        </t>
                        <!-- Salario quincenal (empleado administrativo) -->
                        <t t-set="days_salary" t-value="(o.contract_id.custom_salary * rate) / 2" />
                    </t>
                    <t t-else="">
                        <t t-if="o.struct_id.type_id.default_schedule_pay == 'weekly'">
                            <!-- Salario por hora -->
                            <t t-set="days_salary" t-value="o.contract_id.hourly_wage * 8" />
                        </t>
                        <t t-elif="o.struct_id.type_id.default_schedule_pay == 'bi-monthly'">
                            <!-- Salario quincenal -->
                            <t t-set="days_salary" t-value="o.contract_id.wage / 2" />
                        </t>
                        <t t-else="">
                        </t>
                    </t>
                    <span t-esc="days_salary" t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>
                </td>
                <tr t-foreach="o.line_ids.filtered(lambda line: line.appears_on_payslip and line.category_id.name == 'Base' and line.code == 'TBASICP')" t-as="line">

                    <td>
                        <strong>Salario promedio vacaciones</strong>
                    </td>
                    <td>
                        <span t-esc="line.total" t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>
                    </td>

                </tr>
            </xpath>
            
            <!--Personalizando los numeros de dias: No se muestran los montos-->
            <xpath expr="//div[@class='page']/table[4]/tbody/tr[1]" position="replace">
                <tr t-foreach="o.worked_days_line_ids" t-as="worked_days">

                    <td>
                        <span t-field="worked_days.name"/>
                    </td>

                    <td>
                        <span t-field="worked_days.number_of_hours"/>
                    </td>
                    <td>
                        <span t-field="worked_days.number_of_days"/>
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>

                </tr>
            </xpath>
            
            <!--Lineas de la nomina a pagar-->
            <xpath expr="//div[@class='page']/table[4]/tbody/tr[2]" position="replace">
                <!--Lineas de la nomina a pagar-->
                <tr t-foreach="o.line_ids.filtered(lambda line: line.appears_on_payslip)" t-as="line">
                    <t t-if="line.category_id.name in ['Básico','Prima','Basico2','Deducción','Aporte']">
                        <td>
                            <span t-field="line.name"/>
                        </td>
                        <td></td>
                        <td></td>
                        <!--Asignaciones-->
                        <t t-if="line.category_id.name in ['Básico','Prima','Basico2']">
                            <td style="text-align: center;">
                                <span t-field="line.total"/>
                            </td>
                        </t>
                        <t t-else="">
                            <td style="text-align: center;">
                                <span t-options="{'widget': 'text'}">-</span>
                            </td>
                        </t>
                        <!--Deducciones-->
                        <t t-if="line.category_id.name in ['Deducción','Aporte']">
                            <td style="text-align: center;">
                                <span t-esc="line.total"/>
                            </td>
                        </t>
                        <t t-else="">
                            <td style="text-align: center;">
                                <span t-options="{'widget': 'text'}">-</span>
                            </td>
                        </t>
                    </t>
                </tr>

                <!--Totales-->
                <tr>
                    <td colspan="3" style="text-align: center;">
                        <span>
                            <strong>Totales</strong>:
                        </span>
                    </td>
                    <td style="text-align: center;">
                        <span t-esc="'{:,.2f}'.format(o.accumulated_assignments())"/>
                    </td>
                    <td style="text-align: center;">
                        <span t-esc="'{:,.2f}'.format(o.accumulated_deductions())"/>
                    </td>
                </tr>
                
                <!--Neto a pagar-->
                <tr>
                    <td colspan="3" style="text-align: center;">
                        <span>
                            <strong>Neto a pagar</strong>:
                        </span>
                    </td>
                    <td style="text-align: center;">
                        <span t-esc="'{:,.2f}'.format(o.accumulated_assignments() - o.accumulated_deductions())"/>
                    </td>
                    <td>
                    </td>
                </tr>
            </xpath>

            <!--Centrando la firma-->
            <xpath expr="//div[@class='page']/p[1]" position="replace">
                <table style="width:100%;margin-top:90px;">
                    <tbody>
                        <tr>
                            <td style="width:50%;text-align:center;padding:0px;margin:0px;">
                                <br/>
                                <b>Aprobado_por</b>
                            </td>

                            <td style="width:50%;text-align:center;padding:0px;margin:0px;">
                                <br/>
                                <b>Recibido_por</b>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </xpath>

        </template>
    
    </data>
    
</odoo>
